<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bunkasai 2026 - Gallery</title>

<!-- CSS ã¯ STEP2 ã§è¿½åŠ ã™ã‚‹ã®ã§ã“ã“ã¯ç©ºã®ã¾ã¾ -->
<style>
   /* ===========================
   å…¨ä½“
=========================== */
* { box-sizing: border-box; }

body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: system-ui, sans-serif;
    user-select: none;
    overflow-x: hidden;
}

img, video {
    pointer-events: none;
}

/* ===========================
   HEADER
=========================== */
header {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
}

.logo {
    font-weight: 700;
    font-size: 20px;
}

nav.desktop {
    display: flex;
    gap: 16px;
}

nav.desktop a {
    color: #ccc;
    text-decoration: none;
    font-size: 14px;
}

nav.desktop a.active {
    color: #fff;
    font-weight: 600;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 10px;
}

.lang-toggle button,
.theme-toggle button {
    padding: 4px 8px;
    font-size: 12px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    background: #333;
    color: #fff;
}

/* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ */
.hamburger {
    display: none;
    flex-direction: column;
    gap: 4px;
    cursor: pointer;
}

.hamburger span {
    width: 22px;
    height: 3px;
    background: #fff;
}

/* ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
#nav-menu-mobile {
    display: none;
    position: fixed;
    top: 55px;
    right: 10px;
    background: rgba(0,0,0,0.95);
    padding: 16px;
    border-radius: 10px;
    z-index: 1001;
}

#nav-menu-mobile a {
    display: block;
    color: #fff;
    text-decoration: none;
    margin: 8px 0;
    font-size: 16px;
}

/* ===========================
   MAIN
=========================== */
main {
    padding: 16px;
}

h1 {
    text-align: center;
    margin: 10px 0 5px;
}

.subtitle {
    text-align: center;
    font-size: 13px;
    color: #aaa;
    margin-bottom: 10px;
}

/* ===========================
   TAG FILTER
=========================== */
#tag-filter {
    text-align: center;
    padding: 10px;
}

#tag-filter button {
    margin: 4px;
    padding: 8px 14px;
    border: none;
    background: #333;
    color: #fff;
    border-radius: 999px;
    cursor: pointer;
    font-size: 13px;
}

#tag-filter button.active {
    background: #0af;
    color: #000;
}

/* ===========================
   GALLERY
=========================== */
#gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 14px;
    padding: 10px;
}

.gallery-item {
    cursor: pointer;
    text-align: center;
    background: #111;
    border-radius: 10px;
    padding: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
}

.gallery-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
}

.gallery-item img,
.gallery-item video {
    width: 100%;
    border-radius: 8px;
}

.caption {
    margin-top: 6px;
    font-size: 13px;
    color: #ddd;
}

/* ===========================
   LIGHTBOX
=========================== */
#lightbox {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 2000;
}

#lightbox img,
#lightbox video {
    max-width: 90%;
    max-height: 70%;
}

#lightbox-caption {
    margin-top: 12px;
    font-size: 15px;
    color: #ddd;
    text-align: center;
}

#lightbox-close {
    position: absolute;
    top: 16px;
    right: 24px;
    font-size: 40px;
    cursor: pointer;
}

#lightbox-prev,
#lightbox-next {
    position: absolute;
    top: 50%;
    font-size: 50px;
    cursor: pointer;
    transform: translateY(-50%);
    user-select: none;
}

#lightbox-prev { left: 24px; }
#lightbox-next { right: 24px; }

/* ===========================
   ASSISTANT
=========================== */
#assistant-button {
    position: fixed;
    right: 16px;
    bottom: 16px;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: none;
    background: radial-gradient(circle at 30% 30%, #0ff, #06f);
    color: #fff;
    font-size: 22px;
    cursor: pointer;
    z-index: 3000;
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
}

#assistant-box {
    position: fixed;
    right: 16px;
    bottom: 80px;
    width: 300px;
    max-height: 420px;
    background: #111;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.7);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 3001;
}

#assistant-header {
    padding: 8px 10px;
    background: #222;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.assistant-close {
    cursor: pointer;
}

/* â–¼ ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚µãƒ³ãƒ—ãƒ«è³ªå• */
#assistant-samples {
    padding: 6px 8px;
    background: #181818;
    border-bottom: 1px solid #333;
    font-size: 12px;
}

#assistant-samples summary {
    cursor: pointer;
    padding: 4px 0;
}

.sample-group {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 4px 0 6px;
}

.sample-group button {
    padding: 4px 8px;
    font-size: 11px;
    border: none;
    border-radius: 6px;
    background: #333;
    color: #fff;
    cursor: pointer;
}

/* ãƒãƒ£ãƒƒãƒˆè¡¨ç¤º */
#assistant-chat {
    flex: 1;
    padding: 8px;
    overflow-y: auto;
    font-size: 12px;
}

.chat-row {
    margin-bottom: 6px;
    display: flex;
}

.chat-row.user {
    justify-content: flex-end;
}

.chat-row.bot {
    justify-content: flex-start;
}

.bubble {
    max-width: 80%;
    padding: 6px 8px;
    border-radius: 10px;
}

.bubble.user {
    background: #0af;
    color: #000;
}

.bubble.bot {
    background: #333;
    color: #fff;
}

/* å…¥åŠ›æ¬„ */
#assistant-input-area {
    display: flex;
    border-top: 1px solid #333;
}

#assistant-input {
    flex: 1;
    border: none;
    padding: 6px;
    font-size: 12px;
    background: #111;
    color: #fff;
}

#assistant-send {
    width: 60px;
    border: none;
    background: #0af;
    color: #000;
    font-size: 12px;
    cursor: pointer;
}

/* ===========================
   DARK MODE
=========================== */
body.dark {
    background: #050505;
    color: #f5f5f5;
}

body.dark .gallery-item {
    background: #151515;
}

/* ===========================
   RESPONSIVE
=========================== */
@media (max-width: 768px) {

    nav.desktop {
        display: none;
    }

    .hamburger {
        display: flex;
    }

    #nav-menu-mobile {
        width: 80%;
        right: 10%;
        padding: 20px;
    }

    #nav-menu-mobile a {
        font-size: 18px;
        padding: 12px 0;
    }

    /* ã‚®ãƒ£ãƒ©ãƒªãƒ¼å¤§ãã */
    #gallery {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 16px;
    }

    #tag-filter button {
        font-size: 16px;
        padding: 10px 18px;
    }

    .caption {
        font-size: 15px;
    }

    #lightbox-prev,
    #lightbox-next {
        font-size: 60px;
    }

    #lightbox-close {
        font-size: 48px;
    }
}

</style>

</head>
<body>

<!-- ===========================
      HEADERï¼ˆãƒ­ã‚´ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
=========================== -->
<header>
    <div class="logo">Bunkasai 2026</div>

    <nav class="desktop">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="events.html">Events</a>
        <a href="gallery.html" class="active">Gallery</a>
        <a href="contact.html">Contact</a>
    </nav>

    <div class="header-right">
        <div class="lang-toggle">
            <button onclick="setLang('jp')">æ—¥æœ¬èª</button>
            <button onclick="setLang('en')">English</button>
        </div>

        <div class="theme-toggle">
            <button onclick="toggleTheme()">Dark</button>
        </div>

        <div class="hamburger" onclick="toggleMobileMenu()">
            <span></span><span></span><span></span>
        </div>
    </div>
</header>

<!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="nav-menu-mobile">
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="events.html">Events</a>
    <a href="gallery.html">Gallery</a>
    <a href="contact.html">Contact</a>
</div>

<!-- ===========================
      MAINï¼ˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰
=========================== -->
<main>
    <h1 id="title-text">Gallery</h1>
    <p class="subtitle" id="subtitle-text">
        GitHub ã® img ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰è‡ªå‹•ã§ç”»åƒãƒ»å‹•ç”»ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
    </p>

    <!-- ã‚¿ã‚°ãƒœã‚¿ãƒ³ -->
    <div id="tag-filter"></div>

    <!-- ã‚®ãƒ£ãƒ©ãƒªãƒ¼æœ¬ä½“ -->
    <div id="gallery"></div>
</main>

<!-- ===========================
      LIGHTBOXï¼ˆç”»åƒ/å‹•ç”»ï¼‰
=========================== -->
<div id="lightbox" onclick="closeLightbox(event)">
    <span id="lightbox-close" onclick="closeLightbox(event)">Ã—</span>
    <img id="lightbox-img">
    <video id="lightbox-video" controls></video>

    <!-- ç”»åƒèª¬æ˜ï¼ˆã‚¿ã‚°ã‹ã‚‰ç”Ÿæˆï¼‰ -->
    <div id="lightbox-caption"></div>

    <div id="lightbox-prev" onclick="prevLightbox(event)">â€¹</div>
    <div id="lightbox-next" onclick="nextLightbox(event)">â€º</div>
</div>

<!-- ===========================
      ASSISTANTï¼ˆAIé¢¨ãƒãƒ£ãƒƒãƒˆï¼‰
=========================== -->
<button id="assistant-button" onclick="toggleAssistant()">ğŸ’¬</button>

<div id="assistant-box">
    <div id="assistant-header">
        <span id="assistant-title">Bunkasai Assistant</span>
        <span class="assistant-close" onclick="toggleAssistant()">Ã—</span>
    </div>

    <!-- â–¼ ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚µãƒ³ãƒ—ãƒ«è³ªå•ï¼ˆSTEP3ã§ä¸­èº«ã‚’è¿½åŠ ï¼‰ -->
    <div id="assistant-samples"></div>

    <!-- ãƒãƒ£ãƒƒãƒˆè¡¨ç¤º -->
    <div id="assistant-chat"></div>

    <!-- å…¥åŠ›æ¬„ -->
    <div id="assistant-input-area">
        <input id="assistant-input" type="text" placeholder="è³ªå•ã‚’å…¥åŠ›..." onkeydown="if(event.key==='Enter') assistantSend();">
        <button id="assistant-send" onclick="assistantSend()">é€ä¿¡</button>
    </div>
</div>

<!-- JS ã¯ STEP3 ã§è¿½åŠ ã™ã‚‹ã®ã§ã“ã“ã¯ç©ºã®ã¾ã¾ -->
<script>
   /* ===========================
   ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹
=========================== */
let currentLang = "jp";
let galleryImages = [];
let currentLightboxIndex = 0;

/* ===========================
   å¤šè¨€èªåˆ‡æ›¿
=========================== */
function setLang(lang) {
    currentLang = lang;

    if (lang === "jp") {
        document.getElementById("title-text").textContent = "ã‚®ãƒ£ãƒ©ãƒªãƒ¼";
        document.getElementById("subtitle-text").textContent =
            "GitHub ã® img ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰è‡ªå‹•ã§ç”»åƒãƒ»å‹•ç”»ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚";
        document.getElementById("assistant-title").textContent = "æ–‡åŒ–ç¥­ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ";
        document.getElementById("assistant-input").placeholder = "æ–‡åŒ–ç¥­ã«ã¤ã„ã¦è³ªå•ã—ã¦ã¿ã¦...";
    } else {
        document.getElementById("title-text").textContent = "Gallery";
        document.getElementById("subtitle-text").textContent =
            "Images and videos are automatically loaded from the GitHub img folder.";
        document.getElementById("assistant-title").textContent = "Bunkasai Assistant";
        document.getElementById("assistant-input").placeholder = "Ask about the festival...";
    }
}

/* ===========================
   ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰
=========================== */
function toggleTheme() {
    document.body.classList.toggle("dark");
}

/* ===========================
   ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
=========================== */
function toggleMobileMenu() {
    const m = document.getElementById("nav-menu-mobile");
    m.style.display = (m.style.display === "block") ? "none" : "block";
}

/* ===========================
   ã‚®ãƒ£ãƒ©ãƒªãƒ¼èª­ã¿è¾¼ã¿
=========================== */
function filenameToCaption(name) {
    return name
        .replace(/\.[^/.]+$/, "")
        .replace(/#.*/g, "")
        .replace(/[_-]/g, " ")
        .trim();
}

function extractTags(filename) {
    const base = filename.replace(/\.[^/.]+$/, "");
    const parts = base.split("#");
    return parts.slice(1);
}

async function loadGalleryImages() {
    const apiUrl =
        "https://api.github.com/repos/bunkasai-2026/bunkasai-2026.github.io/contents/img";

    try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        galleryImages = data
            .filter(item => item.type === "file")
            .filter(item => /\.(jpg|jpeg|png|gif|webp|mp4|webm)$/i.test(item.name))
            .map(item => ({
                src: item.download_url,
                type: /\.(mp4|webm)$/i.test(item.name) ? "video" : "image",
                caption: filenameToCaption(item.name),
                tags: extractTags(item.name)
            }));

        galleryImages.sort(() => Math.random() - 0.5);

        renderTagButtons();
        setActiveTag(null); // â† åˆæœŸè¡¨ç¤ºã§ALL
    } catch (e) {
        console.error("ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", e);
    }
}

/* ===========================
   ã‚¿ã‚°ãƒœã‚¿ãƒ³
=========================== */
function renderTagButtons() {
    const container = document.getElementById("tag-filter");
    const tagSet = new Set();

    galleryImages.forEach(img => img.tags.forEach(t => tagSet.add(t)));

    container.innerHTML = "";

    const allBtn = document.createElement("button");
    allBtn.textContent = "ALL";
    allBtn.classList.add("active");
    allBtn.onclick = () => setActiveTag(null);
    container.appendChild(allBtn);

    tagSet.forEach(tag => {
        const btn = document.createElement("button");
        btn.textContent = tag;
        btn.onclick = () => setActiveTag(tag);
        container.appendChild(btn);
    });
}

function setActiveTag(tag) {
    const buttons = document.querySelectorAll("#tag-filter button");
    buttons.forEach(b => b.classList.remove("active"));

    buttons.forEach(b => {
        if (!tag && b.textContent === "ALL") b.classList.add("active");
        if (tag && b.textContent === tag) b.classList.add("active");
    });

    filterByTag(tag);
}

function filterByTag(tag) {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";

    const filtered = galleryImages.filter(img => !tag || img.tags.includes(tag));

    filtered.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "gallery-item";
        div.onclick = () => openLightbox(index);

        if (item.type === "image") {
            const img = document.createElement("img");
            img.src = item.src;
            div.appendChild(img);
        } else {
            const vid = document.createElement("video");
            vid.src = item.src;
            vid.muted = true;
            vid.loop = true;
            vid.autoplay = true;
            vid.playsInline = true;
            div.appendChild(vid);
        }

        const cap = document.createElement("div");
        cap.className = "caption";
        cap.textContent = item.caption;
        div.appendChild(cap);

        gallery.appendChild(div);
    });
}

/* ===========================
   Lightbox
=========================== */
function openLightbox(index) {
    currentLightboxIndex = index;

    const lb = document.getElementById("lightbox");
    const img = document.getElementById("lightbox-img");
    const vid = document.getElementById("lightbox-video");
    const cap = document.getElementById("lightbox-caption");

    const item = galleryImages[currentLightboxIndex];

    lb.style.display = "flex";

    if (item.type === "image") {
        img.style.display = "block";
        vid.style.display = "none";
        img.src = item.src;
    } else {
        img.style.display = "none";
        vid.style.display = "block";
        vid.src = item.src;
    }

    // ã‚¿ã‚°ã‹ã‚‰èª¬æ˜ç”Ÿæˆ
    if (item.tags.length > 0) {
        cap.textContent = `ã“ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã«ã¯ã€Œ${item.tags.join(", ")}ã€ã‚¿ã‚°ãŒä»˜ã„ã¦ã„ã‚‹ã‚ˆã€‚`;
    } else {
        cap.textContent = item.caption;
    }
}

function closeLightbox(event) {
    event.stopPropagation();
    document.getElementById("lightbox").style.display = "none";
}

function prevLightbox(event) {
    event.stopPropagation();
    currentLightboxIndex =
        (currentLightboxIndex - 1 + galleryImages.length) % galleryImages.length;
    openLightbox(currentLightboxIndex);
}

function nextLightbox(event) {
    event.stopPropagation();
    currentLightboxIndex =
        (currentLightboxIndex + 1) % galleryImages.length;
    openLightbox(currentLightboxIndex);
}

/* ===========================
   ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆè¾æ›¸ï¼ˆJP/ENï¼‰
=========================== */
const assistantJP = {
    "ã“ã‚“ã«ã¡ã¯": "ã“ã‚“ã«ã¡ã¯ï¼æ–‡åŒ–ç¥­2026ã«ã¤ã„ã¦ä½•ã‚’çŸ¥ã‚ŠãŸã„ï¼Ÿ",
    "ã„ã¤": "æ–‡åŒ–ç¥­ã¯ 2026å¹´9æœˆ20æ—¥ é–‹å‚¬äºˆå®šã ã‚ˆã€‚",
    "ã©ã“": "å­¦æ ¡ã®ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã§é–‹å‚¬ã•ã‚Œã‚‹ã‚ˆã€‚",
    "æ™‚é–“": "åˆå‰9æ™‚ã€œåˆå¾Œ4æ™‚ã®äºˆå®šã ã‚ˆã€‚",
    "ä¼ç”»": "ã‚¯ãƒ©ã‚¹ä¼ç”»ã€ã‚¹ãƒ†ãƒ¼ã‚¸ã€å±•ç¤ºã€é£²é£Ÿãªã©ç››ã‚Šã ãã•ã‚“ï¼",

    "å…¥å ´æ–™": "å…¥å ´æ–™ã¯ç„¡æ–™ã ã‚ˆã€‚èª°ã§ã‚‚å‚åŠ ã§ãã‚‹ã‚ˆã€‚",
    "ã‚¹ãƒ†ãƒ¼ã‚¸": "ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ãƒ€ãƒ³ã‚¹ã€ãƒãƒ³ãƒ‰ã€æ¼”åŠ‡ãªã©ãŒè¡Œã‚ã‚Œã‚‹äºˆå®šã ã‚ˆã€‚",
    "é£²é£Ÿ": "ç„¼ããã°ã€ã‚¯ãƒ¬ãƒ¼ãƒ—ã€ã‚¿ãƒ”ã‚ªã‚«ãªã©ã®æ¨¡æ“¬åº—ãŒå‡ºã‚‹äºˆå®šã ã‚ˆã€‚",
    "æ··é›‘": "åˆå‰ä¸­ã¯æ¯”è¼ƒçš„ç©ºã„ã¦ã„ã¦ã€åˆå¾Œã¯æ··ã¿ã‚„ã™ã„ã‚ˆã€‚",
    "æŒã¡ç‰©": "ç‰¹ã«å¿…è¦ãªã„ã‘ã©ã€ã‚¹ãƒãƒ›ã¨ãŠé‡‘ãŒã‚ã‚Œã°ååˆ†ã ã‚ˆã€‚",
    "é›¨å¤©": "é›¨å¤©ã§ã‚‚é–‹å‚¬ã•ã‚Œã‚‹ã‚ˆã€‚å±‹å†…ä¼ç”»ã‚‚å¤šã„ã‹ã‚‰å®‰å¿ƒã—ã¦ã­ã€‚",
    "å†™çœŸ": "å†™çœŸæ’®å½±ã¯OKã ã‘ã©ã€ä»–ã®äººã®é¡”ãŒå†™ã‚‹å ´åˆã¯æ³¨æ„ã—ã¦ã­ã€‚",
    "å‹•ç”»": "å‹•ç”»æ’®å½±ã¯OKã ã‘ã©ã€ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ä¸€éƒ¨ç¦æ­¢ã®æ¼”ç›®ãŒã‚ã‚‹ã‚ˆã€‚",
    "è¿·å­": "è¿·ã£ãŸã‚‰æœ¬éƒ¨ã«è¡Œã‘ã°æ¡ˆå†…ã—ã¦ãã‚Œã‚‹ã‚ˆã€‚",
    "ãŠã™ã™ã‚": "åˆå¾Œã®ã‚¹ãƒ†ãƒ¼ã‚¸ä¼ç”»ãŒç‰¹ã«ç››ã‚Šä¸ŠãŒã‚‹ã‹ã‚‰ãŠã™ã™ã‚ã ã‚ˆã€‚",

    // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆä»®ï¼‰
    "ã‚¹ãƒ†ãƒ¼ã‚¸ã®æ™‚é–“": "ã‚¹ãƒ†ãƒ¼ã‚¸ã®è©³ã—ã„æ™‚é–“ã¯ç¾åœ¨èª¿æ•´ä¸­ã ã‚ˆã€‚æ±ºã¾ã‚Šæ¬¡ç¬¬ã“ã“ã§æ¡ˆå†…ã™ã‚‹äºˆå®šã ã‚ˆã€‚",

    "default": "æ–‡åŒ–ç¥­ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã“ã¨ã‚’ã€çŸ­ãã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§èã„ã¦ã¿ã¦ã€‚"
};

const assistantEN = {
    "hello": "Hi! What do you want to know about Bunkasai 2026?",
    "when": "The festival is scheduled on September 20, 2026.",
    "where": "It will be held at the main school campus.",
    "time": "From 9:00 AM to 4:00 PM.",
    "events": "There will be class events, stage shows, exhibitions, and food stalls.",

    "fee": "Admission is free for everyone.",
    "stage": "The stage will feature dance, bands, and theater performances.",
    "food": "There will be food stalls like yakisoba, crepes, and bubble tea.",
    "crowd": "Mornings are less crowded, afternoons get busy.",
    "items": "You don't need muchâ€”just your phone and some money.",
    "rain": "The festival will be held even if it rains. Many events are indoors.",
    "photo": "Photos are allowed, but be careful not to capture strangers' faces.",
    "video": "Videos are allowed, but some stage acts may restrict recording.",
    "lost": "If you get lost, go to the main information booth.",
    "recommend": "The afternoon stage performances are highly recommended.",

    "stage time": "The detailed stage schedule is still being adjusted. It will be announced here once confirmed.",

    "default": "Ask anything about the festival in short keywords."
};

/* ===========================
   ã‚µãƒ³ãƒ—ãƒ«è³ªå•ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰
=========================== */
document.getElementById("assistant-samples").innerHTML = `
<details open>
    <summary>ğŸª æ–‡åŒ–ç¥­å…¨èˆ¬</summary>
    <div class="sample-group">
        <button onclick="assistantSample('ã„ã¤')">æ–‡åŒ–ç¥­ã¯ã„ã¤ï¼Ÿ</button>
        <button onclick="assistantSample('ã©ã“')">å ´æ‰€ã¯ï¼Ÿ</button>
        <button onclick="assistantSample('å…¥å ´æ–™')">å…¥å ´æ–™ã¯ï¼Ÿ</button>
        <button onclick="assistantSample('æ··é›‘')">æ··é›‘ã™ã‚‹æ™‚é–“å¸¯ã¯ï¼Ÿ</button>
        <button onclick="assistantSample('é›¨å¤©')">é›¨å¤©æ™‚ã¯ï¼Ÿ</button>
    </div>
</details>

<details>
    <summary>ğŸ” é£²é£Ÿ</summary>
    <div class="sample-group">
        <button onclick="assistantSample('é£²é£Ÿ')">é£²é£Ÿã«ã¤ã„ã¦</button>
        <button onclick="assistantSample('ãŠã™ã™ã‚')">ãŠã™ã™ã‚ã®æ¨¡æ“¬åº—</button>
        <button onclick="assistantSample('ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼')">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾å¿œ</button>
    </div>
</details>

<details>
    <summary>ğŸ¤ ã‚¹ãƒ†ãƒ¼ã‚¸</summary>
    <div class="sample-group">
        <button onclick="assistantSample('ã‚¹ãƒ†ãƒ¼ã‚¸')">ã‚¹ãƒ†ãƒ¼ã‚¸ã«ã¤ã„ã¦</button>
        <button onclick="assistantSample('ã‚¹ãƒ†ãƒ¼ã‚¸ã®æ™‚é–“')">ã‚¹ãƒ†ãƒ¼ã‚¸ã®æ™‚é–“</button>
        <button onclick="assistantSample('å‹•ç”»')">æ’®å½±ã¯OKï¼Ÿ</button>
    </div>
</details>

<details>
    <summary>ğŸ« æ ¡å†…æ¡ˆå†…</summary>
    <div class="sample-group">
        <button onclick="assistantSample('è¿·å­')">è¿·ã£ãŸã‚‰ï¼Ÿ</button>
        <button onclick="assistantSample('ãƒˆã‚¤ãƒ¬')">ãƒˆã‚¤ãƒ¬ã¯ã©ã“ï¼Ÿ</button>
        <button onclick="assistantSample('ä¼‘æ†©')">ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹</button>
    </div>
</details>
`;

/* ===========================
   ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆé€ä¿¡
=========================== */
function assistantSample(text) {
    document.getElementById("assistant-input").value = text;
    assistantSend();
}

function assistantSend() {
    const inputEl = document.getElementById("assistant-input");
    const text = inputEl.value.trim();
    if (!text) return;

    appendBubble(text, "user");
    inputEl.value = "";

    // è€ƒãˆä¸­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    const thinkingId = "thinking-" + Date.now();
    appendThinking(thinkingId);

    setTimeout(() => {
        removeThinking(thinkingId);

        const key = text.toLowerCase();
        const dict = (currentLang === "jp") ? assistantJP : assistantEN;
        let res = dict[key] || dict["default"];

        // è‡ªç„¶ãªè¿”äº‹ï¼ˆå‰ç½®ãï¼‹èªå°¾ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        const prefixes = currentLang === "jp"
            ? ["ãªã‚‹ã»ã©ã€‚", "ã„ã„è³ªå•ã ã­ã€‚", "ãã†ã ã­ã€‚", ""]
            : ["Good question.", "I see.", "Alright.", ""];
        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];

        if (currentLang === "jp" && res.endsWith("ã‚ˆã€‚")) {
            const tails = ["ã‚ˆã€‚", "ã­ã€‚", "ã‹ãªã€‚", "ã¨æ€ã†ã‚ˆã€‚"];
            const base = res.replace(/ã‚ˆã€‚$/, "");
            res = base + tails[Math.floor(Math.random() * tails.length)];
        }

        appendBubble(prefix ? prefix + "\n" + res : res, "bot");
    }, 700 + Math.random() * 500);
}

function appendBubble(text, who) {
    const chat = document.getElementById("assistant-chat");
    const row = document.createElement("div");
    row.className = "chat-row " + (who === "user" ? "user" : "bot");

    const bubble = document.createElement("div");
    bubble.className = "bubble " + (who === "user" ? "user" : "bot");
    bubble.textContent = text;

    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
}

function appendThinking(id) {
    const chat = document.getElementById("assistant-chat");
    const row = document.createElement("div");
    row.className = "chat-row bot";
    row.id = id;

    const bubble = document.createElement("div");
    bubble.className = "bubble bot";
    bubble.textContent = "â€¦";

    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
}

function removeThinking(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
}

/* ===========================
   ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆé–‹é–‰
=========================== */
function toggleAssistant() {
    const box = document.getElementById("assistant-box");
    box.style.display = (box.style.display === "flex") ? "none" : "flex";
}

/* ===========================
   åˆæœŸåŒ–
=========================== */
document.addEventListener("DOMContentLoaded", () => {
    setLang("jp");
    loadGalleryImages();
});

</script>

</body>
</html>

