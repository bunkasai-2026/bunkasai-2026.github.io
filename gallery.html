<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bunkasai 2026 - Gallery</title>

<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #000;
        color: #fff;
        user-select: none;
        overflow-x: hidden;
    }
    img, video {
        pointer-events: none;
    }

    header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(0,0,0,0.85);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 16px;
    }
    .logo {
        font-weight: 700;
        letter-spacing: 1px;
    }
    nav {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    nav a {
        color: #ccc;
        text-decoration: none;
        font-size: 14px;
    }
    nav a.active {
        color: #fff;
        font-weight: 600;
    }

    .lang-toggle button,
    .theme-toggle button {
        margin-left: 6px;
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        background: #333;
        color: #fff;
    }

    .hamburger {
        display: none;
        flex-direction: column;
        gap: 4px;
        cursor: pointer;
    }
    .hamburger span {
        width: 20px;
        height: 2px;
        background: #fff;
    }
    #nav-menu-mobile {
        display: none;
        position: fixed;
        top: 50px;
        right: 10px;
        background: rgba(0,0,0,0.95);
        padding: 10px 16px;
        border-radius: 8px;
        z-index: 1001;
    }
    #nav-menu-mobile a {
        display: block;
        color: #fff;
        text-decoration: none;
        margin: 6px 0;
        font-size: 14px;
    }

    main {
        padding: 16px;
    }

    h1 {
        text-align: center;
        margin: 10px 0 5px;
    }
    p.subtitle {
        text-align: center;
        font-size: 13px;
        color: #aaa;
        margin: 0 0 10px;
    }

    /* „Çø„Ç∞„Éú„Çø„É≥ */
    #tag-filter {
        text-align: center;
        padding: 10px;
    }
    #tag-filter button {
        margin: 4px;
        padding: 6px 12px;
        border: none;
        background: #333;
        color: #fff;
        border-radius: 999px;
        cursor: pointer;
        font-size: 12px;
    }
    #tag-filter button.active {
        background: #0af;
        color: #000;
    }

    /* „ÇÆ„É£„É©„É™„Éº */
    #gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 12px;
        padding: 10px;
    }
    .gallery-item {
        cursor: pointer;
        text-align: center;
        background: #111;
        border-radius: 10px;
        padding: 8px;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .gallery-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    }
    .gallery-item img,
    .gallery-item video {
        width: 100%;
        border-radius: 8px;
    }
    .caption {
        margin-top: 6px;
        font-size: 13px;
        color: #ddd;
    }

    /* Lightbox */
    #lightbox {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
    }
    #lightbox img,
    #lightbox video {
        max-width: 90%;
        max-height: 80%;
    }
    #lightbox-close {
        position: absolute;
        top: 16px;
        right: 24px;
        font-size: 32px;
        cursor: pointer;
    }
    #lightbox-prev,
    #lightbox-next {
        position: absolute;
        top: 50%;
        font-size: 40px;
        cursor: pointer;
        transform: translateY(-50%);
        user-select: none;
    }
    #lightbox-prev { left: 24px; }
    #lightbox-next { right: 24px; }

    /* „ÉÅ„É£„ÉÉ„Éà */
    #assistant-button {
        position: fixed;
        right: 16px;
        bottom: 16px;
        width: 52px;
        height: 52px;
        border-radius: 50%;
        border: none;
        background: radial-gradient(circle at 30% 30%, #0ff, #06f);
        color: #fff;
        font-size: 22px;
        cursor: pointer;
        z-index: 3000;
        box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    }
    #assistant-box {
        position: fixed;
        right: 16px;
        bottom: 80px;
        width: 280px;
        max-height: 360px;
        background: #111;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.7);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 3001;
    }
    #assistant-header {
        padding: 8px 10px;
        background: #222;
        font-size: 13px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    #assistant-chat {
        flex: 1;
        padding: 8px;
        overflow-y: auto;
        font-size: 12px;
    }
    .chat-row {
        margin-bottom: 6px;
        display: flex;
    }
    .chat-row.user {
        justify-content: flex-end;
    }
    .chat-row.bot {
        justify-content: flex-start;
    }
    .bubble {
        max-width: 80%;
        padding: 6px 8px;
        border-radius: 10px;
    }
    .bubble.user {
        background: #0af;
        color: #000;
    }
    .bubble.bot {
        background: #333;
        color: #fff;
    }
    #assistant-input-area {
        display: flex;
        border-top: 1px solid #333;
    }
    #assistant-input {
        flex: 1;
        border: none;
        padding: 6px;
        font-size: 12px;
        background: #111;
        color: #fff;
    }
    #assistant-send {
        width: 60px;
        border: none;
        background: #0af;
        color: #000;
        font-size: 12px;
        cursor: pointer;
    }

    /* „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÁî®„ÇØ„É©„ÇπÔºàÁ∞°ÊòìÔºâ */
    body.dark {
        background: #050505;
        color: #f5f5f5;
    }
    body.dark .gallery-item {
        background: #151515;
    }

    @media (max-width: 768px) {
        nav.desktop {
            display: none;
        }
        .hamburger {
            display: flex;
        }
    }
    @media (min-width: 769px) {
        #nav-menu-mobile {
            display: none !important;
        }
    }
</style>
</head>

<body>

<header>
    <div class="logo">Bunkasai 2026</div>

    <nav class="desktop">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="events.html">Events</a>
        <a href="gallery.html" class="active">Gallery</a>
        <a href="contact.html">Contact</a>
    </nav>

    <div style="display:flex; align-items:center; gap:6px;">
        <div class="lang-toggle">
            <button onclick="setLang('jp')">Êó•Êú¨Ë™û</button>
            <button onclick="setLang('en')">English</button>
        </div>
        <div class="theme-toggle">
            <button onclick="toggleTheme()">Dark</button>
        </div>
        <div class="hamburger" onclick="toggleMobileMenu()">
            <span></span><span></span><span></span>
        </div>
    </div>
</header>

<div id="nav-menu-mobile">
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="events.html">Events</a>
    <a href="gallery.html">Gallery</a>
    <a href="contact.html">Contact</a>
</div>

<main>
    <h1 id="title-text">Gallery</h1>
    <p class="subtitle" id="subtitle-text">
        GitHub „ÅÆ img „Éï„Ç©„É´„ÉÄ„Åã„ÇâËá™Âãï„ÅßÁîªÂÉè„ÉªÂãïÁîª„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô„ÄÇ
    </p>

    <div id="tag-filter"></div>
    <div id="gallery"></div>
</main>

<!-- Lightbox -->
<div id="lightbox" onclick="closeLightbox(event)">
    <span id="lightbox-close" onclick="closeLightbox(event)">√ó</span>
    <img id="lightbox-img">
    <video id="lightbox-video" controls></video>
    <div id="lightbox-prev" onclick="prevLightbox(event)">‚Äπ</div>
    <div id="lightbox-next" onclick="nextLightbox(event)">‚Ä∫</div>
</div>

<!-- Assistant -->
<button id="assistant-button" onclick="toggleAssistant()">üí¨</button>
<div id="assistant-box">
    <div id="assistant-header">
        <span id="assistant-title">Bunkasai Assistant</span>
        <span style="cursor:pointer;" onclick="toggleAssistant()">√ó</span>
    </div>
    <div id="assistant-chat"></div>
    <div id="assistant-input-area">
        <input id="assistant-input" type="text" placeholder="Ë≥™Âïè„ÇíÂÖ•Âäõ..." onkeydown="if(event.key==='Enter') assistantSend();">
        <button id="assistant-send" onclick="assistantSend()">ÈÄÅ‰ø°</button>
    </div>
</div>

<script>
/* ================== „Ç∞„É≠„Éº„Éê„É´Áä∂ÊÖã ================== */
let currentLang = "jp";
let galleryImages = [];
let currentLightboxIndex = 0;

/* ================== Â§öË®ÄË™û ================== */
function setLang(lang) {
    currentLang = lang;
    if (lang === "jp") {
        document.getElementById("title-text").textContent = "„ÇÆ„É£„É©„É™„Éº";
        document.getElementById("subtitle-text").textContent =
            "GitHub „ÅÆ img „Éï„Ç©„É´„ÉÄ„Åã„ÇâËá™Âãï„ÅßÁîªÂÉè„ÉªÂãïÁîª„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô„ÄÇ";
        document.getElementById("assistant-title").textContent = "ÊñáÂåñÁ•≠„Ç¢„Ç∑„Çπ„Çø„É≥„Éà";
        document.getElementById("assistant-input").placeholder = "ÊñáÂåñÁ•≠„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè„Åó„Å¶„Åø„Å¶...";
    } else {
        document.getElementById("title-text").textContent = "Gallery";
        document.getElementById("subtitle-text").textContent =
            "Images and videos are automatically loaded from the GitHub img folder.";
        document.getElementById("assistant-title").textContent = "Bunkasai Assistant";
        document.getElementById("assistant-input").placeholder = "Ask about the festival...";
    }
}

/* ================== „ÉÜ„Éº„Éû ================== */
function toggleTheme() {
    document.body.classList.toggle("dark");
}

/* ================== „Éè„É≥„Éê„Éº„Ç¨„Éº ================== */
function toggleMobileMenu() {
    const m = document.getElementById("nav-menu-mobile");
    m.style.display = (m.style.display === "block") ? "none" : "block";
}

/* ================== „ÇÆ„É£„É©„É™„Éº ================== */
function filenameToCaption(name) {
    return name
        .replace(/\.[^/.]+$/, "")
        .replace(/#.*/g, "")
        .replace(/[_-]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
}
function extractTags(filename) {
    const base = filename.replace(/\.[^/.]+$/, "");
    const parts = base.split("#");
    return parts.slice(1);
}

async function loadGalleryImages() {
    const apiUrl =
        "https://api.github.com/repos/bunkasai-2026/bunkasai-2026.github.io/contents/img";
    try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        galleryImages = data
            .filter(item => item.type === "file")
            .filter(item => /\.(jpg|jpeg|png|gif|webp|mp4|webm)$/i.test(item.name))
            .map(item => ({
                src: item.download_url,
                type: /\.(mp4|webm)$/i.test(item.name) ? "video" : "image",
                caption: filenameToCaption(item.name),
                tags: extractTags(item.name)
            }));

        galleryImages.sort(() => Math.random() - 0.5);
        renderTagButtons();
        renderGallery();
    } catch (e) {
        console.error("ÁîªÂÉèË™≠„ÅøËæº„Åø„Ç®„É©„Éº:", e);
    }
}

function renderTagButtons() {
    const container = document.getElementById("tag-filter");
    const tagSet = new Set();
    galleryImages.forEach(img => img.tags.forEach(t => tagSet.add(t)));

    container.innerHTML = "";
    const allBtn = document.createElement("button");
    allBtn.textContent = "ALL";
    allBtn.classList.add("active");
    allBtn.onclick = () => setActiveTag(null);
    container.appendChild(allBtn);

    tagSet.forEach(tag => {
        const btn = document.createElement("button");
        btn.textContent = tag;
        btn.onclick = () => setActiveTag(tag);
        container.appendChild(btn);
    });
}

function setActiveTag(tag) {
    const buttons = document.querySelectorAll("#tag-filter button");
    buttons.forEach(b => b.classList.remove("active"));
    buttons.forEach(b => {
        if (!tag && b.textContent === "ALL") b.classList.add("active");
        if (tag && b.textContent === tag) b.classList.add("active");
    });
    filterByTag(tag);
}

function filterByTag(tag) {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";

    const filtered = galleryImages.filter(img => !tag || img.tags.includes(tag));

    filtered.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "gallery-item";
        div.onclick = () => openLightbox(index, filtered);

        if (item.type === "image") {
            const img = document.createElement("img");
            img.src = item.src;
            div.appendChild(img);
        } else {
            const vid = document.createElement("video");
            vid.src = item.src;
            vid.muted = true;
            vid.loop = true;
            vid.autoplay = true;
            vid.playsInline = true;
            div.appendChild(vid);
        }

        const cap = document.createElement("div");
        cap.className = "caption";
        cap.textContent = item.caption;
        div.appendChild(cap);

        gallery.appendChild(div);
    });
}

/* Lightbox */
function openLightbox(index) {
    currentLightboxIndex = index;
    const lb = document.getElementById("lightbox");
    const img = document.getElementById("lightbox-img");
    const vid = document.getElementById("lightbox-video");
    const item = galleryImages[currentLightboxIndex];

    lb.style.display = "flex";

    if (item.type === "image") {
        img.style.display = "block";
        vid.style.display = "none";
        img.src = item.src;
    } else {
        img.style.display = "none";
        vid.style.display = "block";
        vid.src = item.src;
    }
}
function closeLightbox(event) {
    event.stopPropagation();
    document.getElementById("lightbox").style.display = "none";
}
function prevLightbox(event) {
    event.stopPropagation();
    currentLightboxIndex =
        (currentLightboxIndex - 1 + galleryImages.length) % galleryImages.length;
    openLightbox(currentLightboxIndex);
}
function nextLightbox(event) {
    event.stopPropagation();
    currentLightboxIndex =
        (currentLightboxIndex + 1) % galleryImages.length;
    openLightbox(currentLightboxIndex);
}

/* ================== Á∞°Êòì„Ç¢„Ç∑„Çπ„Çø„É≥„Éà ================== */
const assistantJP = {
    "„Åì„Çì„Å´„Å°„ÅØ": "„Åì„Çì„Å´„Å°„ÅØÔºÅÊñáÂåñÁ•≠2026„Å´„Å§„ÅÑ„Å¶‰Ωï„ÇíÁü•„Çä„Åü„ÅÑÔºü",
    "„ÅÑ„Å§": "ÊñáÂåñÁ•≠„ÅØ 2026Âπ¥9Êúà20Êó• ÈñãÂÇ¨‰∫àÂÆö„Å†„Çà„ÄÇ",
    "„Å©„Åì": "Â≠¶Ê†°„ÅÆ„É°„Ç§„É≥„Ç≠„É£„É≥„Éë„Çπ„ÅßÈñãÂÇ¨„Åï„Çå„Çã„Çà„ÄÇ",
    "ÊôÇÈñì": "ÂçàÂâç9ÊôÇ„ÄúÂçàÂæå4ÊôÇ„ÅÆ‰∫àÂÆö„Å†„Çà„ÄÇ",
    "‰ºÅÁîª": "„ÇØ„É©„Çπ‰ºÅÁîª„ÄÅ„Çπ„ÉÜ„Éº„Ç∏„ÄÅÂ±ïÁ§∫„ÄÅÈ£≤È£ü„Å™„Å©Áõõ„Çä„Å†„Åè„Åï„ÇìÔºÅ",
    "default": "ÊñáÂåñÁ•≠„Å´„Å§„ÅÑ„Å¶Áü•„Çä„Åü„ÅÑ„Åì„Å®„Çí„ÄÅÁü≠„Åè„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßËÅû„ÅÑ„Å¶„Åø„Å¶„ÄÇ"
};
const assistantEN = {
    "hello": "Hi! What do you want to know about Bunkasai 2026?",
    "when": "The festival is scheduled on September 20, 2026.",
    "where": "It will be held at the main school campus.",
    "time": "From 9:00 AM to 4:00 PM.",
    "events": "There will be class events, stage shows, exhibitions, and food stalls.",
    "default": "Ask anything about the festival in short keywords."
};

function appendBubble(text, who) {
    const chat = document.getElementById("assistant-chat");
    const row = document.createElement("div");
    row.className = "chat-row " + (who === "user" ? "user" : "bot");
    const bubble = document.createElement("div");
    bubble.className = "bubble " + (who === "user" ? "user" : "bot");
    bubble.textContent = text;
    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
}

function assistantSend() {
    const inputEl = document.getElementById("assistant-input");
    const text = inputEl.value.trim();
    if (!text) return;
    appendBubble(text, "user");

    const key = text.toLowerCase();
    const dict = (currentLang === "jp") ? assistantJP : assistantEN;
    const res = dict[key] || dict["default"];
    appendBubble(res, "bot");
    inputEl.value = "";
}

function toggleAssistant() {
    const box = document.getElementById("assistant-box");
    box.style.display = (box.style.display === "flex") ? "none" : "flex";
}

/* ================== ÂàùÊúüÂåñ ================== */
document.addEventListener("DOMContentLoaded", () => {
    setLang("jp");
    loadGalleryImages();
});
</script>

</body>
</html>
